<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cross-sectional optimal coherent forecast combination — csocc • FoCo2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cross-sectional optimal coherent forecast combination — csocc"><meta name="description" content="This function implements the optimal linear coherent forecast combination for a
linearly constrained (e.g., hierarchical/grouped) multiple time series
combining forecasts from multiple sources (experts). The method minimizes forecast
errors while ensuring that the resulting forecasts are coherent, meaning
they satisfy the constraints across the time series. Using a linear constrained
optimization approach, csocc combines forecasts from multiple experts,
accounting for the relations between variables and constraints. In addition, linear
inequality constraints (e.g. non-negative forecasts) can be imposed, if needed."><meta property="og:description" content="This function implements the optimal linear coherent forecast combination for a
linearly constrained (e.g., hierarchical/grouped) multiple time series
combining forecasts from multiple sources (experts). The method minimizes forecast
errors while ensuring that the resulting forecasts are coherent, meaning
they satisfy the constraints across the time series. Using a linear constrained
optimization approach, csocc combines forecasts from multiple experts,
accounting for the relations between variables and constraints. In addition, linear
inequality constraints (e.g. non-negative forecasts) can be imposed, if needed."><meta property="og:image" content="https://danigiro.github.io/FoCo2/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FoCo2</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa far fa-newspaper"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/danigiro/FoCo2" aria-label="View on GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://CRAN.R-project.org/package=FoCo2" aria-label="View on CRAN"><span class="fa fab fa-r-project fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Cross-sectional optimal coherent forecast combination</h1>
      <small class="dont-index">Source: <a href="https://github.com/danigiro/FoCo2/blob/HEAD/R/optimal.R" class="external-link"><code>R/optimal.R</code></a></small>
      <div class="d-none name"><code>csocc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements the optimal linear coherent forecast combination for a
linearly constrained (e.g., hierarchical/grouped) multiple time series
combining forecasts from multiple sources (experts). The method minimizes forecast
errors while ensuring that the resulting forecasts are coherent, meaning
they satisfy the constraints across the time series. Using a linear constrained
optimization approach, csocc combines forecasts from multiple experts,
accounting for the relations between variables and constraints. In addition, linear
inequality constraints (e.g. non-negative forecasts) can be imposed, if needed.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">csocc</span><span class="op">(</span><span class="va">base</span>, <span class="va">agg_mat</span>, <span class="va">cons_mat</span>, comb <span class="op">=</span> <span class="st">"ols"</span>, res <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      approach <span class="op">=</span> <span class="st">"proj"</span>, nn <span class="op">=</span> <span class="cn">NULL</span>, settings <span class="op">=</span> <span class="cn">NULL</span>, bounds <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-base">base<a class="anchor" aria-label="anchor" href="#arg-base"></a></dt>
<dd><p>A list of \(p\) numeric (\(h \times n\)) matrix or multivariate time series
(<code>mts</code> class) containing the base forecasts to be reconciled; \(h\) is the forecast
horizon, \(n\) is the total number of time series (\(n = n_u + n_b\)) and
\(p\) is the total number of experts.</p></dd>


<dt id="arg-agg-mat">agg_mat<a class="anchor" aria-label="anchor" href="#arg-agg-mat"></a></dt>
<dd><p>A (\(n_u \times n_b\)) numeric matrix representing the cross-sectional
aggregation matrix, mapping the \(n_b\) bottom-level (free)
variables into the \(n_u\) upper (constrained) variables.</p></dd>


<dt id="arg-cons-mat">cons_mat<a class="anchor" aria-label="anchor" href="#arg-cons-mat"></a></dt>
<dd><p>A (\(n_u \times n\)) numeric matrix representing the cross-sectional
zero constraints: each row represents a constraint equation, and each column represents
a variable. The matrix can be of full rank, meaning the rows are linearly independent,
but this is not a strict requirement, as the function allows for redundancy in the constraints.</p></dd>


<dt id="arg-comb">comb<a class="anchor" aria-label="anchor" href="#arg-comb"></a></dt>
<dd><p>A string specifying the reconciliation method. For details, see <a href="cscov.html">cscov</a>.</p></dd>


<dt id="arg-res">res<a class="anchor" aria-label="anchor" href="#arg-res"></a></dt>
<dd><p>A list of \(p\) numeric (\(N \times n\)) matrix containing the
in-sample residuals. This input is used to compute some covariance matrices.</p></dd>


<dt id="arg-approach">approach<a class="anchor" aria-label="anchor" href="#arg-approach"></a></dt>
<dd><p>A string specifying the approach used to compute the reconciled
forecasts. Options include:</p><ul><li><p>"<code>proj</code>" (<em>default</em>): zero-constrained projection approach.</p></li>
<li><p>"<code>strc</code>": structural approach.</p></li>
</ul></dd>


<dt id="arg-nn">nn<a class="anchor" aria-label="anchor" href="#arg-nn"></a></dt>
<dd><p>A string specifying the algorithm to compute non-negative forecasts:</p><ul><li><p>"<code>osqp</code>": OSQP solver (Stellato et al., 2020).</p></li>
<li><p>"<code>sntz</code>": heuristic "set-negative-to-zero" (Di Fonzo and Girolimetto, 2023).</p></li>
</ul></dd>


<dt id="arg-settings">settings<a class="anchor" aria-label="anchor" href="#arg-settings"></a></dt>
<dd><p>An object of class <code>osqpSettings</code> specifying settings
for the <a href="https://osqp.org/" class="external-link"><span class="pkg">osqp</span></a> solver. For details, refer to the
<a href="https://osqp.org/" class="external-link"><span class="pkg">osqp</span> documentation</a> (Stellato et al., 2020).</p></dd>


<dt id="arg-bounds">bounds<a class="anchor" aria-label="anchor" href="#arg-bounds"></a></dt>
<dd><p>A matrix (see <code>set_bounds</code> in
<a href="https://danigiro.github.io/FoReco/reference/set_bounds.html" class="external-link"><span class="pkg">FoReco</span></a>)
with 3 columns (\(i,lower,upper\)), such that</p><ul><li><p>Column 1 represents the cross-sectional series (\(i = 1, \dots, n\)).</p></li>
<li><p>Column 2 indicates the <em>lower</em> bound.</p></li>
<li><p>Column 3 indicates the <em>upper</em> bound.</p></li>
</ul></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <a href="cscov.html">cscov</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A (\(h \times n\)) numeric matrix of cross-sectional combined and reconciled forecasts.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If an expert does not provide a forecast for a given variable,
the missing value can be represented as <code>NA</code>.
For instance, consider a case where the number of experts is
\(p = 4\), with \(n = 3\) variables and \(h = 2\). If the
second and third experts do not provide forecasts for, respectively, the second and first variable,
the corresponding matrix in the base list will be as follows:
$$\texttt{base[[1]]} = \begin{bmatrix} \hat{y}_{1,1}^{1} &amp; \hat{y}_{2,1}^{1} &amp; \hat{y}_{3,1}^{1} \\
\hat{y}_{1,2}^{1} &amp; \hat{y}_{2,2}^{1} &amp; \hat{y}_{3,2}^{1} \end{bmatrix}, \quad
\texttt{base[[2]]} = \begin{bmatrix} \hat{y}_{1,1}^{2} &amp; \texttt{NA} &amp; \hat{y}_{3,1}^{2} \\
\hat{y}_{1,2}^{2} &amp; \texttt{NA} &amp; \hat{y}_{3,2}^{2} \end{bmatrix},$$
$$\texttt{base[[3]]} = \begin{bmatrix} \texttt{NA} &amp; \hat{y}_{2,1}^{3} &amp; \hat{y}_{3,1}^{3} \\
\texttt{NA} &amp; \hat{y}_{2,2}^{3} &amp; \hat{y}_{3,2}^{3} \end{bmatrix}, \quad
\texttt{base[[4]]} = \begin{bmatrix} \hat{y}_{1,1}^{4} &amp; \hat{y}_{2,1}^{4} &amp; \hat{y}_{3,1}^{4} \\
\hat{y}_{1,2}^{4} &amp; \hat{y}_{2,2}^{4} &amp; \hat{y}_{3,2}^{4} \end{bmatrix}.$$</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Di Fonzo, T. and Girolimetto, D. (2023), Spatio-temporal reconciliation of solar
forecasts, <em>Solar Energy</em>, 251, 13–29. <a href="https://doi.org/10.1016/j.solener.2023.01.003" class="external-link">doi:10.1016/j.solener.2023.01.003</a></p>
<p>Girolimetto, D. and Di Fonzo, T. (2024), Coherent forecast combination for linearly
constrained multiple time series, <a href="https://doi.org/10.48550/arXiv.2412.03429" class="external-link">doi:10.48550/arXiv.2412.03429</a>
.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Bemporad, A. and Boyd, S. (2020), OSQP:
An Operator Splitting solver for Quadratic Programs,
<em>Mathematical Programming Computation</em>, 12, 4, 637-672.
<a href="https://doi.org/10.1007/s12532-020-00179-2" class="external-link">doi:10.1007/s12532-020-00179-2</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Optimal combination:
<code><a href="cscov.html">cscov</a>()</code>,
<code><a href="csmtc.html">csmtc</a>()</code>,
<code><a href="occmat.html">occmat</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># (2 x 3) base forecasts matrix (simulated), expert 1</span></span></span>
<span class="r-in"><span><span class="va">base1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># (10 x 3) in-sample residuals matrix (simulated), expert 1</span></span></span>
<span class="r-in"><span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (2 x 3) base forecasts matrix (simulated), expert 2</span></span></span>
<span class="r-in"><span><span class="va">base2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># (10 x 3) in-sample residuals matrix (simulated), expert 2</span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## BALANCED PANEL OF FORECASTS</span></span></span>
<span class="r-in"><span><span class="co"># Base forecasts' and residuals' lists</span></span></span>
<span class="r-in"><span><span class="va">brc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">base1</span>, <span class="va">base2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">erc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">res1</span>, <span class="va">res2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregation matrix for Z = X + Y</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rrc</span> <span class="op">&lt;-</span> <span class="fu">csocc</span><span class="op">(</span>base <span class="op">=</span> <span class="va">brc</span>, agg_mat <span class="op">=</span> <span class="va">A</span>, comb <span class="op">=</span> <span class="st">"wls"</span>, res <span class="op">=</span> <span class="va">erc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Zero constraints matrix for Z - X - Y = 0</span></span></span>
<span class="r-in"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rrc</span> <span class="op">&lt;-</span> <span class="fu">csocc</span><span class="op">(</span>base <span class="op">=</span> <span class="va">brc</span>, cons_mat <span class="op">=</span> <span class="va">C</span>, comb <span class="op">=</span> <span class="st">"wls"</span>, res <span class="op">=</span> <span class="va">erc</span><span class="op">)</span> <span class="co"># same results</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## UNBALANCED PANEL OF FORECASTS</span></span></span>
<span class="r-in"><span><span class="va">base2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="cn">NA</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Base forecasts' and residuals' lists</span></span></span>
<span class="r-in"><span><span class="va">bgc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">base1</span>, <span class="va">base2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">egc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">res1</span>, <span class="va">res2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregation matrix for Z = X + Y</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rgc</span> <span class="op">&lt;-</span> <span class="fu">csocc</span><span class="op">(</span>base <span class="op">=</span> <span class="va">bgc</span>, agg_mat <span class="op">=</span> <span class="va">A</span>, comb <span class="op">=</span> <span class="st">"shrbe"</span>, res <span class="op">=</span> <span class="va">egc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

